<div class="profile-container">
  <div class="profile-form-container">

    <form #form="ngForm" (ngSubmit)="onSubmit()">

      <div class="profile-input-container">
        <label>{{'user.profile.form.native.language.label' | translate}} *:</label>
        <autocomplete-dropdown #nativeLanguageDropdown (dropdownListItemSelect)="onNativeLanguageSelect($event)" [placeholder]="'user.profile.form.native.language.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel" [selectedItemLabelFunction]="namePropertyLabel"
            [getData]="getLanguages()">
        </autocomplete-dropdown>
        <div *ngIf="profileForm.controls['native_language'].hasError('required')" class="alert alert-danger">{{'user.profile.form.native.language.validation.required' | translate}}.</div>
        <div *ngIf="serverValidationErrors.language_id" class="alert alert-danger">{{serverValidationErrors.language_id}}.</div>
      </div>

      <div class="profile-input-container">
        <label>{{'user.profile.form.country.label' | translate}} *:</label>
        <autocomplete-dropdown #countryDropdown (dropdownListItemSelect)="onCountryOfOriginSelect($event)" [placeholder]="'user.profile.form.country.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel" [selectedItemLabelFunction]="namePropertyLabel"
            [getData]="getCountries()">
        </autocomplete-dropdown>
        <div *ngIf="profileForm.controls['country_of_origin'].hasError('required')" class="alert alert-danger">{{'user.profile.form.country.validation.required' | translate}}.</div>
        <div *ngIf="serverValidationErrors.country_of_origin" class="alert alert-danger">{{serverValidationErrors.country_of_origin}}.</div>
      </div>

      <div class="profile-input-container">
        <label>{{'user.profile.form.permit.label' | translate}} *:</label>
        <div class="input-radio-container">
          <div class="input-radio-button-container">
            <label class="input-radio-button-label" for="permit-yes">
            <input class="input-radio-button-input" type="radio" name="permit" id="permit-yes" [formControl]="profileForm.controls['got_permit']" value="true" />
            <span class="input-radio-button-span"></span>
            {{'common.yes' | translate}}</label>
          </div>
          <div class="input-radio-button-container">
            <label class="input-radio-button-label" for="permit-no">
            <input class="input-radio-button-input" type="radio" name="permit" id="permit-no" [formControl]="profileForm.controls['got_permit']" value="false" (click)="profileForm.controls['current_status'].setValue(null)"/>
            <span class="input-radio-button-span"></span>
            {{'common.no' | translate}}</label>
          </div>
        </div>
      </div>

      <div *ngIf="profileForm.value.got_permit === 'true'" class="profile-input-container">
        <label>{{'user.profile.form.permit.type.label' | translate}} *:</label>
        <div class="input-radio-container">
          <div *ngFor="let status of statuses" class="input-radio-button-container">
            <label class="input-radio-button-label" for="{{status.id}}">
            <input class="input-radio-button-input" type="radio" name="permit-type" id="{{status.id}}" (focus)="serverValidationErrors.current_status = ''" [formControl]="profileForm.controls['current_status']" value="{{status.id}}" />
            <span class="input-radio-button-span"></span>
            {{status.name}}</label>
          </div>
        </div>
        <div *ngIf="profileForm.value.got_permit && !profileForm.value.current_status" class="alert alert-danger">{{'user.profile.form.permit.type.validation.required' | translate}}.</div>
        <div *ngIf="serverValidationErrors.current_status" class="alert alert-danger">{{serverValidationErrors.current_status}}.</div>
      </div>

      <div *ngIf="profileForm.value.got_permit === 'true'" class="profile-upload-button-container">
        <input type="file" id="permit-image-filename" name="permit-image-filename" class="input-image-upload" (change)="onPermitImageFilenameChange($event)" accept="image/*">
        <label for="permit-image-filename" class="btn-secondary btn-small btn btn-image-upload">{{'user.profile.form.permit.upload.button' | translate}}</label>
        <p>{{'user.profile.form.permit.upload.description' | translate}}</p>
        <div *ngIf="user.permitImage" class="permit-image" [ngStyle]="{'background-image': 'url(' + user.permitImage.imageUrl + ')'}"></div>
        <div *ngIf="permitImgeSaveSuccess" class="save-message">{{'user.profile.form.permit.upload.success' | translate}}</div>
        <div *ngIf="permitImageSaveFail" class="error-message">{{'user.profile.form.permit.upload.fail' | translate}}</div>
      </div>

      <hr>

      <div class="profile-input-container">
        <label>{{'user.profile.form.languages.label' | translate}}:</label>
        <autocomplete-dropdown (dropdownListItemSelect)="onLanguageSelect($event)" [clearDestinationAfterSelection]="true" [placeholder]="'user.profile.form.languages.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel" [selectedItemLabelFunction]="namePropertyLabel"
            [getData]="getLanguagesExcludingNative()">
        </autocomplete-dropdown>

        <div class="profile-input-languages-table-container">
          <div class="profile-input-languages-table-row-container" *ngFor="let userLanguage of profileForm.value.user_languages">
            <div class="profile-input-languages-table-row-inner-container" *ngIf="userLanguage.proficiency.proficiency !== 5">
              <div class="profile-input-languages-table-row-inner-language-container">
                <p>{{userLanguage.language.name}}</p>
              </div>
              <div class="profile-input-languages-table-row-inner-icon-container" (click)="onRemoveUserLanguage(userLanguage)">
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
              <div class="profile-input-languages-table-row-inner-dropdown-container">
                <autocomplete-dropdown [lookupType]="'list'" [enumList]="languageProficiencyLevelsAvailable" [(destination)]="userLanguage.proficiency" [placeholder]="'language.proficiency.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel"
                    [selectedItemLabelFunction]="namePropertyLabel">
                </autocomplete-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="profile-input-container">
        <label>{{'user.profile.form.skills.label' | translate}}:</label>
        <autocomplete-dropdown (dropdownListItemSelect)="onSkillSelect($event)" [clearDestinationAfterSelection]="true" [placeholder]="'user.profile.form.skills.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel" [selectedItemLabelFunction]="namePropertyLabel"
            [getData]="getSkills()">
        </autocomplete-dropdown>

        <div class="profile-input-languages-table-container">
          <div class="profile-input-languages-table-row-container" *ngFor="let userSkill of profileForm.value.user_skills">
            <div class="profile-input-languages-table-row-inner-container">
              <div class="profile-input-languages-table-row-inner-language-container">
                <p>{{userSkill.skill.name}}</p>
              </div>
              <div class="profile-input-languages-table-row-inner-icon-container" (click)="onRemoveUserSkill(userSkill)">
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
              <div class="profile-input-languages-table-row-inner-dropdown-container">
                <autocomplete-dropdown [lookupType]="'list'" [enumList]="skillProficiencyLevelsAvailable" [(destination)]="userSkill.proficiency" [placeholder]="'skill.proficiency.placeholder' | translate" [autocompleteResultLabelFunction]="namePropertyLabel"
                    [selectedItemLabelFunction]="namePropertyLabel">
                </autocomplete-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="profile-input-container">
        <label>{{'user.profile.form.general.skills.label' | translate}}:</label>
        <textarea class="form-control material-input" name="general-skills" id="general-skills" class="form-control material-input" (focus)="serverValidationErrors.competence_text = ''" autosize type="text" placeholder="{{'user.profile.form.general.skills.placeholder' | translate}}" [formControl]="profileForm.controls['competence_text']"></textarea>
        <div *ngIf="serverValidationErrors.competence_text" class="alert alert-danger">{{serverValidationErrors.competence_text}}.</div>
      </div>

      <div class="profile-input-container">
        <label>{{'user.profile.form.work.experience.label' | translate}}:</label>
        <textarea class="form-control material-input" name="workExperience" id="work-experience" class="form-control material-input" (focus)="serverValidationErrors.job_experience = ''" autosize type="text" placeholder="{{'user.profile.form.work.experience.placeholder' | translate}}" [formControl]="profileForm.controls['job_experience']"></textarea>
        <div *ngIf="serverValidationErrors.job_experience" class="alert alert-danger">{{serverValidationErrors.job_experience}}.</div>
      </div>
      <!--
Documents not supported yet. TODO implement when documents supported in backend.
      <div class="profile-upload-button-container">
        <button class="btn-secondary btn-small btn">{{'user.profile.form.resume.upload.button' | translate}}</button>
        <p>{{'user.profile.form.resume.upload.description' | translate}}</p>
      </div>
-->

      <div class="profile-button-container">
        <div *ngIf="saveFail" class="error-message">{{'user.profile.form.submit.fail' | translate}}</div>
        <div *ngIf="saveSuccess" class="save-message">{{'user.profile.form.submit.success' | translate}}</div>
        <button type="submit" [disabled]="!formValidation()" class="btn-primary btn-small btn">{{'user.profile.form.submit.button' | translate}}</button>
      </div>
    </form>

  </div>
</div>
